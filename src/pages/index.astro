---
import Layout from "@/layouts/Layout.astro";
---

<Layout>
  <div class="max-w-6xl mx-auto py-12 px-4">
    <header class="text-center mb-12">
      <h1 class="text-h1 text-accent mb-4">Confederation College Programs</h1>
      <p class="text-lead text-dark/80 max-w-3xl mx-auto">
        Explore our comprehensive range of programs designed to prepare you for success in your chosen career path.
      </p>
    </header>

    <div id="programs-container" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      <!-- Programs will be loaded here via JavaScript -->
    </div>

    <div id="loading" class="text-center py-12">
      <p class="text-p text-dark/60">Loading programs...</p>
    </div>

    <div id="error" class="text-center py-12 hidden">
      <p class="text-p text-red-600">Unable to load programs. Please try again later.</p>
    </div>
  </div>

  <script>
    // Load program data at runtime
    async function loadPrograms() {
      try {
        const response = await fetch('/program-data.json');
        if (!response.ok) {
          throw new Error('Failed to fetch program data');
        }
        const programs = await response.json();
        
        // Hide loading indicator
        document.getElementById('loading').style.display = 'none';
        
        // Render programs
        renderPrograms(programs);
      } catch (error) {
        console.error('Error loading programs:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').classList.remove('hidden');
      }
    }

    function renderPrograms(programs) {
      const container = document.getElementById('programs-container');
      
      programs.forEach(program => {
        const programCard = createProgramCard(program);
        container.appendChild(programCard);
      });
    }

    function createProgramCard(program) {
      const card = document.createElement('div');
      card.className = 'bg-white border border-dark/10 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow duration-200';
      
      // Program name
      const title = document.createElement('h2');
      title.className = 'text-h3 text-accent mb-3';
      title.textContent = program.name;
      
      // Mission statement with fallback
      const mission = document.createElement('p');
      mission.className = 'text-p text-dark/80 mb-4 line-clamp-4';
      mission.textContent = program.missionStatement || 'No description yet.';
      
      // Program link
      const link = document.createElement('a');
      link.href = `https://www.confederationcollege.ca/programs/${program.slug.current}`;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.className = 'inline-flex items-center text-accent hover:text-accent-yellow transition-colors duration-200 font-medium';
      link.innerHTML = `
        View Program Details
        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
        </svg>
      `;
      
      card.appendChild(title);
      card.appendChild(mission);
      card.appendChild(link);
      
      return card;
    }

    // Load programs when the page loads
    document.addEventListener('DOMContentLoaded', loadPrograms);
  </script>

  <style>
    .line-clamp-4 {
      display: -webkit-box;
      -webkit-line-clamp: 4;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</Layout>
